<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<title>MIDI Recorder</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<script src="https://unpkg.com/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<link rel="icon" type="image/png" sizes="32x32" href="https://t4.ftcdn.net/jpg/03/51/20/39/240_F_351203909_Ylk0KUOOBR8IKwurq6KbZyYufzDjZrqx.jpg">
	<link rel="manifest" href="/site.webmanifest">
	<meta name="apple-mobile-web-app-title" content="JazzJam">
	<meta name="application-name" content="JazzJam">
	<meta name="msapplication-TileColor" content="#b91d47">
	<meta name="theme-color" content="#ff0">

	<link rel="stylesheet" href="lib/aria.modal.css" />
	<link rel="stylesheet" href="lib/inert-polyfill.css" />
	<link rel="stylesheet" href="app.css" />
</head>

<body>
	<div class="container-fluid">
		<div class="jumbotron">
			<h1><b>JazzMIDIJam</b></h1>
			<h4><b><i>Chrome recommended</i></b></h4>
			<h5>Current issue: </h5>
			<ul>
			<li>Fix color</li>
			<li>Sync backing track with start of recording</li>
			</ul>
		</div>
		<div class="row">
			<div class="left" style="background-color: rgba(213, 164, 87, 0.7);">
			<h2>Menu</h2>
			<input type="text" id="mySearch" onkeyup="filterSearch()" placeholder="Search Jazz Standard" title="Type in a category">
			<ul id="myMenu">
				<div class="tab">
				<li><a class="tabs" data-id="afoggyday">A Foggy Day</a></li>
				<li><a class="tabs" data-id="bluebossa">Blue Bossa</a></li>
				<li><a class="tabs" data-id="confirmation">Confirmation</a></li>
				<li><a class="tabs" data-id="donnalee">Donna Lee</a></li>
				<li><a class="tabs" data-id="giantsteps">Giant Steps</a></li>
				<li><a class="tabs" data-id="justfriends">Just Friends</a></li>
				<li><a class="tabs" data-id="Recordame">Recordame</a></li>
				</div>
			</ul>
			</div>
			
			<div class="right">
				<div class="panel" id="afoggyday" onclick="setBPM(130)">
					<figure>
						<figcaption>Listen for a bit:</figcaption>
						<audio controls id="audioPlayer" src="https://github.com/1618lip/JazzMIDIJam/raw/main/BackingTracks/A_Foggy_Day.mp3">
							<a href="https://github.com/1618lip/JazzMIDIJam/raw/main/BackingTracks/A_Foggy_Day.mp3"> Download audio </a>
						</audio>
					</figure>
					<button id="startRecordingButton" onclick="startRecording()">Start Recording</button>
					<div id="countdown"></div>
				</div>
				<div class="panel" id="bluebossa" onclick="setBPM(130)">
					<figure>
						<figcaption>Listen for a bit:</figcaption>
						<audio controls src="https://github.com/1618lip/JazzMIDIJam/raw/main/BackingTracks/Blue_Bossa.mp3">
							<a href="https://github.com/1618lip/JazzMIDIJam/raw/main/BackingTracks/Blue_Bossa.mp3"> Download audio </a>
						</audio>
					</figure>
					<button id="startRecordingButton" onclick="startRecording()">Start Recording</button>
					<div id="countdown"></div>
				</div>
				<div class="panel" id="confirmation" onclick="setBPM(205)">
					<figure>
						<figcaption>Listen for a bit:</figcaption>
						<audio controls src="https://github.com/1618lip/JazzMIDIJam/raw/main/BackingTracks/Confirmation.mp3">
							<a href="https://github.com/1618lip/JazzMIDIJam/raw/main/BackingTracks/Confirmation.mp3"> Download audio </a>
						</audio>
					</figure>
					<button id="startRecordingButton" onclick="startRecording()">Start Recording</button>
					<div id="countdown"></div>
				</div>
				<div class="panel" id="donnalee" onclick="setBPM(185)">
					<figure>
						<figcaption>Listen for a bit:</figcaption>
						<audio controls src="https://github.com/1618lip/JazzMIDIJam/raw/main/BackingTracks/Donna_Lee.mp3">
							<a href="https://github.com/1618lip/JazzMIDIJam/raw/main/BackingTracks/Donna_Lee.mp3"> Download audio </a>
						</audio>
					</figure>
					<button id="startRecordingButton" onclick="startRecording()">Start Recording</button>
					<div id="countdown"></div>
				</div>
				<div class="panel" id="giantsteps" onclick="setBPM(200)">
					<figure>
						<figcaption>Listen for a bit:</figcaption>
						<audio controls src="https://github.com/1618lip/JazzMIDIJam/raw/main/BackingTracks/Giant_Steps.mp3">
							<a href="https://github.com/1618lip/JazzMIDIJam/raw/main/BackingTracks/Giant_Steps.mp3"> Download audio </a>
						</audio>
					</figure>
					<button id="startRecordingButton" onclick="startRecording()">Start Recording</button>
					<div id="countdown"></div>
				</div>
				<div class="panel" id="justfriends" onclick="setBPM(190)">
					<figure>
						<figcaption>Listen for a bit:</figcaption>
						<audio controls src="https://github.com/1618lip/JazzMIDIJam/raw/main/BackingTracks/Just_Friends.mp3">
							<a href="https://github.com/1618lip/JazzMIDIJam/raw/main/BackingTracks/Just_Friends.mp3"> Download audio </a>
						</audio>
					</figure>
					<button id="startRecordingButton" onclick="startRecording()">Start Recording</button>
					<div id="countdown"></div>
				</div>
			</div>
		</div>
	</div>
	<script>
		//******************Search Filter****************
		// Cache out tab container, and all of the panels
		const tabs = document.querySelector('.tab');
		const panels = document.querySelectorAll('.panel');

		// Add an event listener to the tabs container
		tabs.addEventListener('click', handleClick);

		// When a child element of `tabs` is clicked
		function handleClick(e) {
		
		// Check to see if it's a tab
		if (e.target.matches('.tabs')) {

			// For every element in the `panels` node list, use `classList`
			// to remove the show class
			panels.forEach(panel => panel.classList.remove('show'));

			// "Destructure" the `id` from the button's data set
			const { id } = e.target.dataset;

			// Create a selector that will match the corresponding
			// panel with that id. We're using a template string to
			// help form the selector. Basically it says find me an element
			// with a "panel" class which also has an id that matches the id of
			// the button's data attribute which we just retrieved.
			const selector = `.panel[id="${id}"]`;

			// Select the `div` and, using classList, again add the
			// show class
			document.querySelector(selector).classList.add('show');
		}
		}

		function filterSearch() {
		var input, filter, ul, li, a, i;
		input = document.getElementById("mySearch");
		filter = input.value.toUpperCase();
		ul = document.getElementById("myMenu");
		li = ul.getElementsByTagName("li");
		for (i = 0; i < li.length; i++) {
			a = li[i].getElementsByTagName("a")[0];
			if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
			li[i].style.display = "";
			} else {
			li[i].style.display = "none";
			}
		}
		}
		//****************************************************
		
		let countdownValue = 4; // Set the countdown duration in seconds

		function startRecording() {
			// Hide the audio player and show the countdown
			document.getElementById('audioPlayer').style.display = 'none';
			document.getElementById('startRecordingButton').style.display = 'none';
			document.getElementById('countdown').style.display = 'block';

			// Start the countdown
			let countdownInterval = setInterval(function () {
				document.getElementById('countdown').innerHTML = countdownValue;
				countdownValue--;

				if (countdownValue < 0) {
					// Display the audio player, hide the countdown, and start playing the audio
					document.getElementById('audioPlayer').style.display = 'block';
					document.getElementById('countdown').style.display = 'none';
					document.getElementById('audioPlayer').play();
					clearInterval(countdownInterval);
				}
			}, 1000);
		}
		// ***************** Get BPM*************
		function setBPM(value) {
			// Set the window.bpm variable to the specified value
			window.bpm = value;

			// You can call the function to handle the BPM input if needed
			// getBPM();
		}
		// Common code to be added to each panel
		function addCommonCodeToPanel(panelId, bpm) {
        	var panel = document.getElementById(panelId);
			
			// Create a main element
			var mainElement = document.createElement("main");
			mainElement.className = "app-main";
			mainElement.innerHTML = `
            			<noscript>
							This app requires JavaScript.
						</noscript>
						<div id="controls">
							<span class="visually-hidden">.</span> <!-- for screen readers, or at least ChromeVox -->
							<fieldset class="ui-section">
								<legend>Input</legend>
								<span class="visually-hidden">.</span> <!-- for screen readers, or at least ChromeVox -->
								<h3>MIDI devices:</h3>
								<div id="midi-devices-area">
									<p id="loading-midi-devices-message" hidden>Loading...</p>
									<p id="no-midi-devices-message" hidden>No MIDI devices detected</p>
									<table id="midi-devices" aria-live="assertive"></table>
									<div id="midi-not-supported" hidden>
										<div class="error-message">
											This browser doesn't support MIDI access.
											Try using Chrome, or for other browsers, the
											<a href="https://jazz-soft.net/download/web-midi/">Jazz-Soft Web MIDI API extension</a>.
										</div>
										<button class="button-functional" id="demo-button">
											<span class="button-visual">
												<span id="demo-button-stop-text" hidden>
													<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" height="1em">
														<polygon points="0,0 0,100 100,100 100,0" fill="#FFF" class="fill-cc"/>
													</svg>
													Stop Demo
												</span>
												<span id="demo-button-start-text">
													<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" height="1em">
														<polygon points="0,0 0,100 100,50" fill="#FFF" class="fill-cc"/>
													</svg>
													Demo
												</span>
											</span>
										</button>
									</div>
									<div id="midi-access-failed" class="error-message" hidden>
										Failed to get MIDI access.
										<pre id="midi-access-failed-pre"></pre>
									</div>
								</div>
								<button id="troubleshoot-midi-input-button" class="popover-button" aria-haspopup="dialog" aria-expanded="false">
									<svg fill="currentColor" height="1em" viewBox="0 0 40 40" style="vertical-align: bottom;">
										<path
											d="m18.4 15v-3.4h3.2v3.4h-3.2z m1.6 18.4c7.3 0 13.4-6.1 13.4-13.4s-6.1-13.4-13.4-13.4-13.4 6.1-13.4 13.4 6.1 13.4 13.4 13.4z m0-30c9.2 0 16.6 7.4 16.6 16.6s-7.4 16.6-16.6 16.6-16.6-7.4-16.6-16.6 7.4-16.6 16.6-16.6z m-1.6 25v-10h3.2v10h-3.2z">
										</path>
									</svg>
									<u>MIDI device not showing up?</u>
								</button>
								<div id="troubleshoot-midi-input-popover" class="popover" hidden>
									<ul class="bulleted-list">
										<li>Make sure it's plugged into your computer and turned on.</li>
										<li>Try <a href="JavaScript:location.reload();">refreshing the page</a>.</li>
										<li>If that doesn't work, try unplugging it and plugging it back in.</li>
										<li>Try restarting your computer.</li>
									</ul>
									<div class="popover-arrow" data-popper-arrow></div>
								</div>
							</fieldset>
							<fieldset id="midi-exporting" class="ui-section">
								<legend>Export</legend>
								<div id="midi-exporting-clearing-controls">
									<button class="button-functional" id="export-midi-file-button" disabled aria-keyshortcuts="Ctrl+S Meta+S">
										<span class="button-visual">
											Save MIDI File
										</span>
									</button>
									<span id="name-or-message">
										<span id="no-notes-recorded-message" tabindex="0">&nbsp;- No notes recorded</span>
										<input type="text" id="recording-name-input" hidden/>
									</span>
									<span style="flex: 1"></span>
									<button class="button-functional" id="clear-button" disabled>
										<span class="button-visual">
											Clear
										</span>
									</button>
									<button class="button-functional" id="undo-clear-button" hidden>
										<span class="button-visual">
											Undo Clear
										</span>
									</button>
								</div>
								<br>
								<div class="error-message" hidden id="recovery-error-message"></div>
								<!-- Modal libraries like to replace your buttons' id attributes apparently... -->
								<!-- Also there's no equivalent data-modal-hidden to make it not unhide the button if it's hidden -->
								<button class="button-functional show-recovery-button" disabled data-modal-disabled data-modal-open="recovery-modal-content">
									<span class="button-visual">
										<span class="loading-indicator"></span>
										Recover Recordings
									</span>
								</button>
								<div id="recovery-modal-content" hidden data-modal>
									<div data-modal-document>
										<h3>Recover Recordings</h3>
										<ul id="recoverables"></ul>
										<p id="recovery-empty-message" hidden>
											No more recordings to recover.
										</p>
									</div>
								</div>
				
							</fieldset>
						
							<div id="fullscreen-target">
								<canvas id="midi-viz-canvas" class="element-to-transform"></canvas>
							</div>
						</div>
        	`;

			// Append mainElement to the panel
			panel.appendChild(mainElement);

			// Call setBPM function with the specified BPM
			setBPM(bpm);
    }

    // Call addCommonCodeToPanel for each panel with the corresponding BPM
	
    //addCommonCodeToPanel("afoggyday", 130);
    //addCommonCodeToPanel("bluebossa", 130);
	//addCommonCodeToPanel("confirmation", 205);
	addCommonCodeToPanel("donnalee", 185);
	//addCommonCodeToPanel("giantsteps", 200);
	//addCommonCodeToPanel("justfriends", 190);
	
    // Repeat for other panels
	</script>
	<script src="lib/FileSaver.js"></script>
	<script src="lib/popper-2.11.5.js"></script>
	<script src="lib/aria.modal.js"></script>
	<script src="lib/inert-polyfill.js"></script>
	<script src="lib/SimpleMidiInput.js"></script>
	<script src="lib/midifile/MIDIEvents.js"></script>
	<script src="lib/midifile/MIDIFile.js"></script>
	<script>JZZ={MIDI:{noteValue(){}}}</script>
	<script src="lib/JZZ.midi.GM.js"></script>
	<script src="lib/localforage.js"></script>
	<script src="compiled/app.js"></script>
</body>
</html>
